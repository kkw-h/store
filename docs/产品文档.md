# ğŸ“˜ ç¤¾åŒºè´­å°ç¨‹åº V1.1 - æ ¸å¿ƒé€»è¾‘ä¸æ•°æ®æ¶æ„

## 1. æ ¸å¿ƒä¸šåŠ¡æµç¨‹å˜æ›´ç‚¹

### A. é…é€æ¨¡å¼ï¼šå¢åŠ â€œæ¥å•/æ‹’å•â€æœºåˆ¶
ç”±äºä½ æåˆ°â€œå•†å®¶åœ¨è®¢å•é‡Œç¡®è®¤æ˜¯å¦å¯ä»¥é…é€â€ï¼Œè¿™æ„å‘³ç€æ”¯ä»˜åéœ€è¦ä¸€ä¸ª**â€œå•†å®¶å®¡æ ¸â€**ç¯èŠ‚ã€‚
*   **æµç¨‹ï¼š** ç”¨æˆ·æ”¯ä»˜ â” è®¢å•çŠ¶æ€ï¼š**[å¾…æ¥å•]** â” å•†å®¶æŸ¥çœ‹åœ°å€ â” å•†å®¶ç‚¹å‡»â€œæ¥å•â€ (å˜ä¸ºé…é€ä¸­) æˆ– â€œæ— æ³•é…é€â€ (è§¦å‘è‡ªåŠ¨é€€æ¬¾)ã€‚
*   **ä¼˜åŠ¿ï¼š** é¿å…äº†å¤æ‚çš„åœ°å›¾å›´æ å¼€å‘æˆæœ¬ï¼Œç”±å•†å®¶äººå·¥åˆ¤æ–­è·ç¦»æ˜¯å¦åˆé€‚ã€‚

### B. èµ„é‡‘æµï¼šç›´è¿æ¨¡å¼
*   **æœºåˆ¶ï¼š** å°ç¨‹åºç›´æ¥ç»‘å®šå•†å®¶çš„â€œå¾®ä¿¡æ”¯ä»˜å•†æˆ·å·â€ã€‚
*   **ç‰¹ç‚¹ï¼š** èµ„é‡‘ä¸ç»è¿‡å¹³å°ï¼ˆT+1ç›´æ¥åˆ°å•†å®¶é“¶è¡Œå¡ï¼‰ï¼Œæ— éœ€å¼€å‘â€œæç°â€åŠŸèƒ½ï¼Œåˆè§„æ€§æœ€é«˜ã€‚

### C. è®¢å•å®Œç»“ï¼šå•†å®¶ä¸»å¯¼
*   **é…é€å•ï¼š** å•†å®¶é€è¾¾åï¼Œåœ¨åå°ç‚¹å‡»â€œå·²é€è¾¾â€ï¼Œè®¢å•ç›´æ¥å˜æ›´ä¸ºâ€œå·²å®Œæˆâ€ã€‚ï¼ˆçœå»äº†ç”¨æˆ·å¿˜è®°ç‚¹ç¡®è®¤æ”¶è´§çš„éº»çƒ¦ï¼‰ã€‚

---

## 2. è®¢å•çŠ¶æ€æœº (Order State Machine)

è¿™æ˜¯å¼€å‘ä¸­æœ€å…³é”®çš„é€»è¾‘ï¼Œè¯·ç›´æ¥å‘ç»™åç«¯å¼€å‘äººå‘˜ã€‚

| çŠ¶æ€ç  | çŠ¶æ€åç§° | è§¦å‘æ¡ä»¶ | ä¸‹ä¸€æ­¥æ“ä½œ |
| :--- | :--- | :--- | :--- |
| `0` | **å¾…æ”¯ä»˜** | ç”¨æˆ·ä¸‹å• | æ”¯ä»˜ / å–æ¶ˆ / 15åˆ†é’Ÿè¶…æ—¶ |
| `1` | **å¾…æ¥å•** (ä»…é…é€) | ç”¨æˆ·æ”¯ä»˜æˆåŠŸ | å•†å®¶ï¼š**[æ¥å•]** æˆ– **[æ‹’å•é€€æ¬¾]** |
| `2` | **å¾…è‡ªæ** (ä»…è‡ªæ) | ç”¨æˆ·æ”¯ä»˜æˆåŠŸ | å•†å®¶ï¼š**[æ‰«ç æ ¸é”€]** |
| `3` | **é…é€ä¸­** | å•†å®¶ç‚¹å‡»â€œæ¥å•â€ | å•†å®¶ï¼š**[ç¡®è®¤é€è¾¾]** |
| `4` | **å·²å®Œæˆ** | å•†å®¶ç‚¹å‡»â€œé€è¾¾â€æˆ–â€œæ ¸é”€â€ | è¯„ä»· (å¯é€‰) |
| `-1` | **å·²å–æ¶ˆ/é€€æ¬¾** | è¶…æ—¶æœªä»˜ / å•†å®¶æ‹’å• | - |

---

## 3. æ•°æ®åº“è®¾è®¡ (Database Schema)

è¿™æ˜¯è½åœ°çš„æ ¸å¿ƒï¼ŒåŸºäº**MySQL**çš„è¡¨ç»“æ„å»ºè®®ã€‚

### 3.1 åº—é“ºé…ç½®è¡¨ (`shop_config`)
*ç”¨äºå­˜å‚¨è¥ä¸šæ—¶é—´å’ŒåŸºç¡€è®¾ç½®ï¼Œå•åº—æ¨¡å¼ä¸‹é€šå¸¸åªæœ‰ä¸€è¡Œæ•°æ®ã€‚*

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| `id` | INT | ä¸»é”® |
| `shop_name` | VARCHAR | åº—é“ºåç§° |
| `open_time` | TIME | è¥ä¸šå¼€å§‹æ—¶é—´ (å¦‚ 09:00:00) |
| `close_time` | TIME | è¥ä¸šç»“æŸæ—¶é—´ (å¦‚ 22:00:00) |
| `is_open` | TINYINT | ç´§æ€¥å¼€å…³ (1è¥ä¸š 0æ‰“çƒŠ) |
| `delivery_fee` | DECIMAL | åŸºç¡€è¿è´¹ |
| `min_buy_amount` | DECIMAL | èµ·é€é‡‘é¢ |

### 3.2 å•†å“è¡¨ (`products`)
*å‚è€ƒç›’é©¬ç»“æ„ï¼Œæ”¯æŒåˆ†ç±»å’ŒåŸºç¡€ä¿¡æ¯ã€‚*

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| `id` | INT | å•†å“ID |
| `category_id` | INT | å…³è”åˆ†ç±»ID |
| `name` | VARCHAR | å•†å“åç§° |
| `thumb_url` | VARCHAR | ç¼©ç•¥å›¾ |
| `price` | DECIMAL | ç°ä»· |
| `original_price` | DECIMAL | åŸä»· (åˆ’çº¿ä»·) |
| `stock` | INT | åº“å­˜ |
| `status` | TINYINT | 1ä¸Šæ¶ 0ä¸‹æ¶ |

### 3.3 è®¢å•ä¸»è¡¨ (`orders`)
*æ ¸å¿ƒäº¤æ˜“è®°å½•ã€‚*

| å­—æ®µå | ç±»å‹ | è¯´æ˜ |
| :--- | :--- | :--- |
| `id` | BIGINT | è®¢å•ID |
| `order_no` | VARCHAR | è®¢å•å· (å”¯ä¸€ï¼Œå¦‚ 202312170001) |
| `user_id` | INT | ä¹°å®¶ID |
| `total_amount` | DECIMAL | è®¢å•æ€»é‡‘é¢ |
| `delivery_type` | ENUM | **'delivery'(é…é€)**, **'pickup'(è‡ªæ)** |
| `status` | TINYINT | å¯¹åº”ä¸Šè¿°çŠ¶æ€æœº (0, 1, 2, 3, 4, -1) |
| `pickup_code` | VARCHAR | **6ä½å–è´§ç ** (ä»…è‡ªæå•æœ‰å€¼) |
| `pickup_time` | DATETIME | é¢„çº¦è‡ªææ—¶é—´ |
| `address_snapshot` | TEXT | æ”¶è´§åœ°å€å¿«ç…§ (ä»…é…é€å•æœ‰å€¼) |
| `created_at` | DATETIME | ä¸‹å•æ—¶é—´ |

---
# 4. å…³é”®é€»è¾‘å®ç°ç»†èŠ‚ (ç»™å¼€å‘çš„Tips)

### 4.1 è¥ä¸šæ—¶é—´åˆ¤æ–­é€»è¾‘ (å‰ç«¯+åç«¯)
*   **å‰ç«¯ï¼š** ç”¨æˆ·è¿›å…¥â€œæäº¤è®¢å•é¡µâ€æ—¶ï¼Œè·å– `shop_config` ä¸­çš„ `open_time` å’Œ `close_time`ã€‚
    *   å¦‚æœå½“å‰æ—¶é—´ä¸åœ¨è¥ä¸šèŒƒå›´å†…ï¼Œ**ç¦ç”¨â€œç«‹å³é…é€â€é€‰é¡¹**ã€‚
    *   åœ¨â€œè‡ªææ—¶é—´é€‰æ‹©å™¨â€ä¸­ï¼Œåªæ¸²æŸ“è¥ä¸šæ—¶é—´æ®µå†…çš„æ—¶é—´æ ¼ï¼ˆä¾‹å¦‚æ¯30åˆ†é’Ÿä¸€ä¸ªæ ¼ï¼‰ã€‚
*   **åç«¯ï¼š** ä¸‹å•æ¥å£ (`/api/order/create`) å¿…é¡»å†æ¬¡æ ¡éªŒæ—¶é—´ï¼Œé˜²æ­¢ç”¨æˆ·é€šè¿‡ä¿®æ”¹æœ¬åœ°æ—¶é—´å¼ºè¡Œä¸‹å•ã€‚

### 4.2 å•†å®¶æ¥å•ä¸æ‹’å• (é…é€æ¨¡å¼)
*   **åœºæ™¯ï¼š** ç”¨æˆ·å¡«äº†ä¸€ä¸ªå¾ˆè¿œçš„åœ°å€å¹¶æ”¯ä»˜äº†ã€‚
*   **å•†å®¶ç«¯æ“ä½œï¼š**
    *   å•†å®¶åœ¨åå°çœ‹åˆ°â€œå¾…æ¥å•â€åˆ—è¡¨ã€‚
    *   ç‚¹å‡» **[æŸ¥çœ‹åœ°å›¾]** (è°ƒç”¨å¾®ä¿¡å†…ç½®åœ°å›¾æŸ¥çœ‹è·ç¦»)ã€‚
    *   **æƒ…å†µA (æ¥å•)ï¼š** ç‚¹å‡»â€œæ¥å•â€ï¼Œè§¦å‘å¾®ä¿¡æœåŠ¡é€šçŸ¥å‘ŠçŸ¥ç”¨æˆ·â€œå•†å®¶å·²æ¥å•ï¼Œæ­£åœ¨é…é€â€ã€‚
    *   **æƒ…å†µB (æ‹’å•)ï¼š** ç‚¹å‡»â€œæ— æ³•é…é€â€ï¼Œç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨å¾®ä¿¡æ”¯ä»˜é€€æ¬¾æ¥å£ (`refund`)ï¼Œèµ„é‡‘åŸè·¯è¿”å›ï¼Œå¹¶å‘é€é€šçŸ¥â€œéå¸¸æŠ±æ­‰ï¼Œè¶…å‡ºé…é€èŒƒå›´ï¼Œå·²ä¸ºæ‚¨é€€æ¬¾â€ã€‚

### 4.3 å”¯ä¸€å–è´§ç ç”Ÿæˆç®—æ³•
ä¸ºäº†é˜²æ­¢æ’ç ï¼Œå»ºè®®ä½¿ç”¨ç®€å•çš„éšæœºæ•°+æ ¡éªŒï¼Œæˆ–è€…ç›´æ¥åˆ©ç”¨æ—¶é—´æˆ³åå‡ ä½ã€‚
*   **ç®€å•æ–¹æ¡ˆï¼š** `Random(100000, 999999)`ã€‚
*   **å±•ç¤ºï¼š** åœ¨ç”¨æˆ·ç«¯è®¢å•è¯¦æƒ…é¡µï¼Œå°†è¿™6ä½æ•°å­—æ”¾å¤§æ˜¾ç¤ºï¼Œæœ€å¥½ç”Ÿæˆä¸€ä¸ªäºŒç»´ç ï¼ˆå†…å®¹å°±æ˜¯è¿™6ä½æ•°å­—ï¼‰ï¼Œæ–¹ä¾¿å•†å®¶ç›´æ¥æ‰«ã€‚

---

## 5. å¼€å‘ä¼˜å…ˆçº§å»ºè®® (MVP Roadmap)

ä¸ºäº†æœ€å¿«ä¸Šçº¿ï¼Œå»ºè®®æŒ‰æ­¤é¡ºåºå¼€å‘ï¼š

1.  **ç¬¬ä¸€å‘¨ï¼šå•†å“ä¸å±•ç¤º**
    *   å®Œæˆå•†å“åˆ†ç±»ã€åˆ—è¡¨å±•ç¤ºã€è´­ç‰©è½¦é€»è¾‘ï¼ˆæœ¬åœ°ç¼“å­˜ï¼‰ã€‚
2.  **ç¬¬äºŒå‘¨ï¼šäº¤æ˜“æ ¸å¿ƒ**
    *   ç”¨æˆ·ä¸‹å•ã€å¾®ä¿¡æ”¯ä»˜å¯¹æ¥ã€è®¢å•è¡¨ç”Ÿæˆã€‚
    *   **é‡ç‚¹ï¼š** è·‘é€šâ€œè‡ªæâ€æµç¨‹ï¼ˆç”Ÿæˆç  -> æ‰«ç æ ¸é”€ï¼‰ã€‚
3.  **ç¬¬ä¸‰å‘¨ï¼šé…é€ä¸ç®¡ç†**
    *   å¢åŠ â€œé…é€â€ç±»å‹çš„åœ°å€å¡«å†™ã€å•†å®¶æ¥å•/æ‹’å•é€»è¾‘ã€‚
    *   å®Œå–„å•†å®¶ç®¡ç†åå°ï¼ˆæ‰‹æœºç«¯ç½‘é¡µæˆ–å°ç¨‹åºå†…åµŒç®¡ç†é¡µï¼‰ã€‚

## 6.é¡¹ç›®ç›®å½•ç®¡ç†

#### store-mini ç”¨æˆ·å°ç¨‹åºç«¯ Uni-app (Vue3 + TS)
#### store-server-mini å•†å®¶ç«¯å°ç¨‹åºç«¯ Uni-app (Vue3 + TS)
#### store-server-pc å•†å®¶ç«¯PC Vue 3 + Vite + Element Plus
#### store-api ç¨‹åº API FastAPI
``` text 
store-api/
â”œâ”€â”€ app/
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ main.py              # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ core/                # æ ¸å¿ƒé…ç½®
â”‚   â”‚   â”œâ”€â”€ config.py        # è¯»å– .env é…ç½® (æ•°æ®åº“URL, å¯†é’¥)
â”‚   â”‚   â””â”€â”€ security.py      # JWT è®¤è¯é€»è¾‘
â”‚   â”œâ”€â”€ db/                  # æ•°æ®åº“ç›¸å…³
â”‚   â”‚   â”œâ”€â”€ session.py       # æ•°æ®åº“è¿æ¥æ± 
â”‚   â”‚   â””â”€â”€ base.py          # ORM åŸºç±»
â”‚   â”œâ”€â”€ models/              # æ•°æ®åº“æ¨¡å‹ (å¯¹åº” PostgreSQL è¡¨)
â”‚   â”‚   â”œâ”€â”€ user.py
â”‚   â”‚   â”œâ”€â”€ product.py
â”‚   â”‚   â””â”€â”€ order.py
â”‚   â”œâ”€â”€ schemas/             # Pydantic æ¨¡å‹ (ç”¨äº API è¯·æ±‚/å“åº”éªŒè¯)
â”‚   â”‚   â”œâ”€â”€ order.schema.py
â”‚   â”‚   â””â”€â”€ token.schema.py
â”‚   â”œâ”€â”€ api/                 # æ¥å£è·¯ç”±
â”‚   â”‚   â””â”€â”€ v1/
â”‚   â”‚       â”œâ”€â”€ endpoints/
â”‚   â”‚       â”‚   â”œâ”€â”€ auth.py
â”‚   â”‚       â”‚   â”œâ”€â”€ orders.py
â”‚   â”‚       â”‚   â””â”€â”€ products.py
â”‚   â”‚       â””â”€â”€ api.py       # è·¯ç”±æ±‡æ€»
â”‚   â””â”€â”€ services/            # å¤æ‚ä¸šåŠ¡é€»è¾‘ (å¦‚: æ”¯ä»˜å›è°ƒå¤„ç†ã€åº“å­˜æ‰£å‡)
â”‚       â””â”€â”€ order_service.py
â”œâ”€â”€ alembic/                 # æ•°æ®åº“è¿ç§»è„šæœ¬ç›®å½•
â”œâ”€â”€ .env                     # ç¯å¢ƒå˜é‡ (DBå¯†ç ç­‰)
â”œâ”€â”€ requirements.txt         # ä¾èµ–åˆ—è¡¨
â””â”€â”€ Dockerfile               # éƒ¨ç½²é…ç½®

```
DATABASE_URL = "postgresql+asyncpg://store_app:lMjAV7N0Zq3jCh@localhost:5432/community_store_db"