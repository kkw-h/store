# ç¤¾åŒºè´­å°ç¨‹åºé¡¹ç›®å¼€å‘è§„åˆ’æ–¹æ¡ˆ (V1.0)

## 1. é¡¹ç›®æ¦‚å†µ
æœ¬é¡¹ç›®æ—¨åœ¨æ„å»ºä¸€å¥—è½»é‡çº§çš„ç¤¾åŒºå›¢è´­/å¤–å–å°ç¨‹åºç³»ç»Ÿï¼Œæ”¯æŒâ€œé…é€â€ä¸â€œè‡ªæâ€åŒæ¨¡å¼ï¼Œé‡‡ç”¨ç›´è¿å¾®ä¿¡æ”¯ä»˜èµ„é‡‘æµï¼Œç”±å•†å®¶è‡ªä¸»ç®¡ç†è®¢å•é…é€ä¸æ ¸é”€ã€‚ç³»ç»ŸåŒ…å«ç”¨æˆ·ç«¯å°ç¨‹åºã€å•†å®¶ç«¯å°ç¨‹åºåŠPCç®¡ç†åå°ã€‚

**æ ¸å¿ƒæ–‡æ¡£ä¾æ®ï¼š**
- éœ€æ±‚ä¸ä¸šåŠ¡æµç¨‹ï¼š`docs/äº§å“æ–‡æ¡£.md`
- æ¥å£è§„èŒƒï¼š`docs/APIè§„åˆ’.md`
- æ•°æ®æ¶æ„ï¼š`docs/db è§„åˆ’.md`

---

## 2. é¡¹ç›®é‡Œç¨‹ç¢‘ä¸æ—¶é—´èŠ‚ç‚¹ (MVP 3å‘¨è®¡åˆ’)
åŸºäºæ–‡æ¡£ä¸­çš„ "MVP Roadmap"ï¼Œé¡¹ç›®åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼Œé¢„è®¡æ€»å·¥æœŸä¸º 3 å‘¨ã€‚

### ğŸ“… Phase 1: åŸºç¡€æ¶æ„ä¸å•†å“å±•ç¤º (ç¬¬1å‘¨)
**ç›®æ ‡ï¼š** å®Œæˆå‰åç«¯åŸºç¡€æ­å»ºï¼Œå®ç°å•†å“æµè§ˆä¸è´­ç‰©è½¦åŠŸèƒ½ã€‚
- **T1-T2:** ç¯å¢ƒæ­å»º (PostgreSQL, FastAPI, Uni-app)ã€æ•°æ®åº“å»ºè¡¨ (`shop_config`, `products`, `categories`)ã€‚
- **T3-T4:** åç«¯åŸºç¡€æ¥å£å¼€å‘ (åˆ†ç±»åˆ—è¡¨, å•†å“åˆ—è¡¨, è¯¦æƒ…)ã€‚
- **T5-T6:** å‰ç«¯é¦–é¡µã€åˆ†ç±»é¡µã€è´­ç‰©è½¦é¡µé¢å¼€å‘ (æœ¬åœ°ç¼“å­˜é€»è¾‘)ã€‚
- **T7:** è”è°ƒæµ‹è¯•ä¸UIå¾®è°ƒã€‚

### ğŸ“… Phase 2: äº¤æ˜“æ ¸å¿ƒä¸æ”¯ä»˜æµç¨‹ (ç¬¬2å‘¨)
**ç›®æ ‡ï¼š** æ‰“é€šä¸‹å•ã€æ”¯ä»˜ã€è®¢å•çŠ¶æ€æµè½¬ï¼ˆé‡ç‚¹æ˜¯è‡ªææµç¨‹ï¼‰ã€‚
- **T1-T2:** ç”¨æˆ·è®¤è¯æ¨¡å— (å¾®ä¿¡ç™»å½•, JWTç”Ÿæˆ)ã€æ”¶è´§åœ°å€ç®¡ç†ã€‚
- **T3-T4:** è®¢å•æ ¸å¿ƒé€»è¾‘å¼€å‘ (ä¸‹å•æ¥å£ `order/create`, é¢„æ£€æ¥å£ `preview`)ã€‚
- **T5:** å¾®ä¿¡æ”¯ä»˜å¯¹æ¥ (ç»Ÿä¸€ä¸‹å•, å›è°ƒå¤„ç† webhook)ã€‚
- **T6:** è‡ªææµç¨‹é—­ç¯ (ç”Ÿæˆ6ä½å–è´§ç , æ‰«ç æ ¸é”€æ¥å£)ã€‚
- **T7:** äº¤æ˜“æµç¨‹è”è°ƒ (ç¡®ä¿çŠ¶æ€æœº `0->2->4` æ­£å¸¸æµè½¬)ã€‚

### ğŸ“… Phase 3: é…é€ç®¡ç†ä¸å•†å®¶åå° (ç¬¬3å‘¨)
**ç›®æ ‡ï¼š** å®Œå–„é…é€æ¨¡å¼ï¼Œä¸Šçº¿å•†å®¶ç®¡ç†åŠŸèƒ½ï¼Œè¿›è¡Œæ•´ä½“éªŒæ”¶ã€‚
- **T1-T2:** é…é€æ¨¡å¼é€»è¾‘ (åœ°å€å¿«ç…§, å•†å®¶æ¥å•/æ‹’å•æ¥å£ `admin/order/audit`)ã€‚
- **T3-T4:** å•†å®¶ç«¯å°ç¨‹åº/PCåå°å¼€å‘ (è®¢å•åˆ—è¡¨, æ¥å•æ“ä½œ, æ‰«ç æ ¸é”€)ã€‚
- **T5:** è¥ä¸šæ—¶é—´åˆ¤æ–­é€»è¾‘ (å‰ç«¯æ‹¦æˆª + åç«¯æ ¡éªŒ)ã€‚
- **T6:** ç³»ç»Ÿå…¨é¢æµ‹è¯• (å¹¶å‘é”æµ‹è¯•, è¾¹ç•Œæ¡ä»¶æµ‹è¯•)ã€‚
- **T7:** éƒ¨ç½²ä¸Šçº¿ä¸æ–‡æ¡£äº¤ä»˜ã€‚

---

## 3. åŠŸèƒ½æ¨¡å—è¯¦ç»†åˆ’åˆ†

### 3.1 Cç«¯ç”¨æˆ·å°ç¨‹åº (store-mini)
| æ¨¡å— | åŠŸèƒ½ç‚¹ | å¯¹åº”API/æ–‡æ¡£ |
| :--- | :--- | :--- |
| **ç”¨æˆ·è®¤è¯** | å¾®ä¿¡æˆæƒç™»å½•ã€JWT Tokenç®¡ç† | `POST /auth/login` |
| **å•†å“å±•ç¤º** | é¦–é¡µBannerã€åˆ†ç±»ä¾§è¾¹æ ã€å•†å“åˆ—è¡¨ã€å•†å“è¯¦æƒ… | `products` è¡¨ |
| **è´­ç‰©è½¦** | æ·»åŠ /å‡å°‘å•†å“ã€æœ¬åœ°æŒä¹…åŒ–ã€ç»“ç®—é¢„è§ˆ | `POST /order/preview` |
| **è®¢å•äº¤æ˜“** | å¡«å†™å¤‡æ³¨ã€é€‰æ‹©é…é€/è‡ªæã€å¾®ä¿¡æ”¯ä»˜è°ƒèµ· | `POST /order/create` |
| **ä¸ªäººä¸­å¿ƒ** | æˆ‘çš„è®¢å•åˆ—è¡¨ã€è®¢å•è¯¦æƒ…(å±•ç¤ºæ ¸é”€ç )ã€åœ°å€ç®¡ç† | `GET /order/list` |

### 3.2 å•†å®¶ç«¯å°ç¨‹åº/PC (store-server-mini/pc)
| æ¨¡å— | åŠŸèƒ½ç‚¹ | å¯¹åº”API/æ–‡æ¡£ |
| :--- | :--- | :--- |
| **å·¥ä½œå°** | å¾…å¤„ç†è®¢å•æ¦‚è§ˆã€æ–°è®¢å•è¯­éŸ³æ’­æŠ¥ | WebSocket/è½®è¯¢ |
| **è®¢å•ç®¡ç†** | å¾…æ¥å•åˆ—è¡¨(æ¥å•/æ‹’å•)ã€é…é€ä¸­(ç¡®è®¤é€è¾¾)ã€è‡ªæ(æ‰«ç æ ¸é”€) | `POST /admin/order/audit` |
| **å•†å“ç®¡ç†** | å•†å“ä¸Šä¸‹æ¶ã€ä»·æ ¼ä¿®æ”¹ã€åº“å­˜è°ƒæ•´ | `products` è¡¨ |
| **åº—é“ºè®¾ç½®** | è¥ä¸šçŠ¶æ€å¼€å…³ã€è¥ä¸šæ—¶é—´è®¾ç½®ã€è¿è´¹é…ç½® | `shop_config` è¡¨ |

---

## 4. æŠ€æœ¯æ¶æ„è®¾è®¡

### 4.1 æŠ€æœ¯æ ˆ (ä¾æ® `docs/äº§å“æ–‡æ¡£.md`)
- **å‰ç«¯ (User/Merchant):** Uni-app (Vue 3 + TypeScript) - ä¸€å¥—ä»£ç å‘å¸ƒå¾®ä¿¡å°ç¨‹åºã€‚
- **å•†å®¶PCåå°:** Vue 3 + Vite + Element Plusã€‚
- **åç«¯:** Python FastAPI (å¼‚æ­¥é«˜æ€§èƒ½æ¡†æ¶)ã€‚
- **æ•°æ®åº“:** PostgreSQL (ä½¿ç”¨ `asyncpg` é©±åŠ¨)ã€‚
- **éƒ¨ç½²:** Docker å®¹å™¨åŒ–éƒ¨ç½²ã€‚

### 4.2 ç›®å½•ç»“æ„è§„åˆ’
```text
/Users/hanxiaodi/www/node/store/
â”œâ”€â”€ docs/                 # é¡¹ç›®æ–‡æ¡£
â”œâ”€â”€ store-mini/           # Cç«¯å°ç¨‹åº (Uni-app)
â”œâ”€â”€ store-server-mini/    # å•†å®¶ç«¯å°ç¨‹åº (Uni-app)
â”œâ”€â”€ store-server-pc/      # å•†å®¶PCåå° (Vue3)
â””â”€â”€ store-api/            # åç«¯API (FastAPI)
    â”œâ”€â”€ app/
    â”‚   â”œâ”€â”€ api/v1/       # æ¥å£è·¯ç”±
    â”‚   â”œâ”€â”€ core/         # é…ç½®ä¸å®‰å…¨
    â”‚   â”œâ”€â”€ models/       # SQLAlchemy/Tortoise æ¨¡å‹
    â”‚   â””â”€â”€ services/     # ä¸šåŠ¡é€»è¾‘ (è®¢å•çŠ¶æ€æœº)
    â””â”€â”€ alembic/          # æ•°æ®åº“è¿ç§»
```

### 4.3 æ•°æ®åº“å…³é”®è®¾è®¡ (ä¾æ® `docs/db è§„åˆ’.md`)
- **æ ¸å¿ƒè¡¨:** `orders` (äº¤æ˜“), `order_items` (å¿«ç…§), `shop_config` (é…ç½®).
- **å…³é”®æœºåˆ¶:**
    - **åœ°å€å¿«ç…§ (`JSONB`):** è®¢å•ç”Ÿæˆæ—¶å›ºåŒ–åœ°å€ä¿¡æ¯ï¼Œä¸éšç”¨æˆ·ä¿®æ”¹åœ°å€ç°¿å˜åŒ–ã€‚
    - **æ•°å€¼ç²¾åº¦:** é‡‘é¢ç»Ÿä¸€ä½¿ç”¨ `NUMERIC(10, 2)`ï¼Œä¸¥ç¦ floatã€‚
    - **æ—¶é—´å¤„ç†:** ç»Ÿä¸€ä½¿ç”¨ `TIMESTAMPTZ`ã€‚

---

## 5. å¼€å‘èµ„æºåˆ†é…æ–¹æ¡ˆ

| è§’è‰² | äººå‘˜ | èŒè´£èŒƒå›´ |
| :--- | :--- | :--- |
| **åç«¯å¼€å‘** | 1äºº | APIè®¾è®¡ä¸å®ç°ã€æ•°æ®åº“ç®¡ç†ã€æ”¯ä»˜æ¥å£å¯¹æ¥ã€äº‘æœåŠ¡å™¨éƒ¨ç½² |
| **å‰ç«¯å¼€å‘** | 1äºº | Cç«¯å°ç¨‹åºã€å•†å®¶ç«¯å°ç¨‹åºã€PCåå°ç•Œé¢å¼€å‘ä¸è”è°ƒ |
| **æµ‹è¯•/PM** | 1äºº | éœ€æ±‚æŠŠæ§ã€ç”¨ä¾‹ç¼–å†™ã€éªŒæ”¶æµ‹è¯• (å¯ç”±äº§å“ç»ç†å…¼ä»») |

*æ³¨ï¼šé‰´äºé¡¹ç›®è§„æ¨¡ï¼Œå»ºè®®é‡‡ç”¨å…¨æ ˆå¼€å‘æ¨¡å¼æˆ–ç´§å¯†é…åˆçš„ 2 äººå°ç»„ã€‚*

---

## 6. è´¨é‡ä¿è¯æªæ–½ (QA)

1.  **ä»£ç è§„èŒƒ:**
    - å‰ç«¯ï¼šESLint + Prettier (Vue3 Standard)ã€‚
    - åç«¯ï¼šFlake8 + Blackï¼Œéµå¾ª PEP8ã€‚
2.  **æµ‹è¯•ç­–ç•¥:**
    - **å•å…ƒæµ‹è¯•:** é‡ç‚¹è¦†ç›– `OrderService` ä¸­çš„çŠ¶æ€æœºæµè½¬é€»è¾‘ã€é‡‘é¢è®¡ç®—é€»è¾‘ã€‚
    - **æ¥å£æµ‹è¯•:** ä½¿ç”¨ Postman æˆ– Pytest è¿›è¡Œ API è¦†ç›–æµ‹è¯•ã€‚
    - **å¹¶å‘æµ‹è¯•:** é’ˆå¯¹ `æ‰«ç æ ¸é”€` å’Œ `æ¥å•` æ¥å£è¿›è¡Œå¹¶å‘å‹åŠ›æµ‹è¯•ï¼ŒéªŒè¯é”æœºåˆ¶æœ‰æ•ˆæ€§ã€‚
3.  **Code Review:** æ¯å‘¨äº”è¿›è¡Œä¸€æ¬¡ä»£ç èµ°æŸ¥ï¼Œé‡ç‚¹æ£€æŸ¥æ”¯ä»˜å›è°ƒçš„å®‰å…¨æ ¡éªŒå’Œ SQL æ€§èƒ½ã€‚

---

## 7. é£é™©ç®¡ç†ç­–ç•¥

| é£é™©ç‚¹ | é£é™©ç­‰çº§ | åº”å¯¹ç­–ç•¥ |
| :--- | :--- | :--- |
| **å¾®ä¿¡æ”¯ä»˜ç”³è¯·** | é«˜ | éœ€æå‰ç”³è¯·å•†æˆ·å·ï¼Œå¼€å‘æœŸé—´ä½¿ç”¨æ²™ç®±ç¯å¢ƒæˆ–ä¸ªäººæµ‹è¯•å·å…ˆè¡Œè°ƒè¯•ã€‚ |
| **åœ°å›¾å®šä½åå·®** | ä¸­ | é…é€æ¨¡å¼åˆæœŸé‡‡ç”¨â€œå•†å®¶äººå·¥å®¡æ ¸è·ç¦»â€æœºåˆ¶ï¼ˆè§æ–‡æ¡£1.Aï¼‰ï¼Œè§„é¿LBSå¼€å‘å¤æ‚åº¦ã€‚ |
| **è®¢å•è¶…å–** | ä¸­ | æ•°æ®åº“å±‚é¢åˆ©ç”¨ `stock > 0` çº¦æŸï¼Œä¸‹å•æ‰£åº“å­˜é‡‡ç”¨åŸå­æ“ä½œæˆ–æ•°æ®åº“é”ã€‚ |
| **æ ¸é”€ç å†²çª** | ä½ | é‡‡ç”¨ `Random` + æ•°æ®åº“å”¯ä¸€ç´¢å¼•æ ¡éªŒï¼Œæˆ–è€…åŸºäºæ—¶é—´æˆ³æ··æ·†ç”Ÿæˆã€‚ |

---

## 8. å¯è§†åŒ–è¿›åº¦æ¦‚è§ˆ (Gantt Chart)

```mermaid
gantt
    title ç¤¾åŒºè´­é¡¹ç›®å¼€å‘ç”˜ç‰¹å›¾
    dateFormat  YYYY-MM-DD
    section ç¬¬ä¸€å‘¨ï¼šåŸºç¡€ä¸å•†å“
    ç¯å¢ƒæ­å»º & DBè®¾è®¡       :done,    des1, 2023-12-18, 2d
    åç«¯åŸºç¡€API            :active,  des2, after des1, 2d
    å‰ç«¯é¦–é¡µä¸è´­ç‰©è½¦        :         des3, after des2, 3d
    section ç¬¬äºŒå‘¨ï¼šäº¤æ˜“æ ¸å¿ƒ
    ç”¨æˆ·è®¤è¯ & åœ°å€ç®¡ç†     :         des4, 2023-12-25, 2d
    ä¸‹å•ä¸æ”¯ä»˜å¯¹æ¥          :         des5, after des4, 3d
    è‡ªææµç¨‹é—­ç¯            :         des6, after des5, 2d
    section ç¬¬ä¸‰å‘¨ï¼šç®¡ç†ä¸éªŒæ”¶
    é…é€é€»è¾‘ä¸å•†å®¶åå°      :         des7, 2024-01-01, 4d
    å…¨é¢æµ‹è¯•ä¸éƒ¨ç½²          :         des8, after des7, 3d
```